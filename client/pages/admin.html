<html lang="en">

<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- User List -->
            <div class="col-md-4 d-flex flex-column p-3" style="height: 100vh;">
                <button class="btn btn-primary mb-2" id="addUser">+ Add User</button>
                <select multiple class="form-select flex-grow-1" id="userSelect" style="min-height: 0;"></select>
            </div>

            <!-- User Info Card -->
            <div class="col-md-8 d-flex align-items-center justify-content-center p-3" style="height: 100vh;">
                <div class="card w-100 h-100" id="userCard">
                    <div class="card-body d-flex flex-column">
                        <h1 class="card-title" id="userName">Select a user</h1>
                        <p class="card-text" id="userDetails">User details will appear here when you select a user from
                            the list.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $.ajax({
                type: 'POST',
                url: `${apiCall}/getUserList`,
                data: JSON.stringify({ uuidSessionToken: sessionStorage.getItem('SimpleSession') }),
                contentType: 'application/json',
                success: function (results) {
                    console.log(results.Users)
                    let userRow = '';
                    results.Users.forEach(user => {
                        userRow = '<option onClick="selectUser(' + user.EmployeeID + ')">' + user.DisplayName + '</option>';
                        $('#userSelect').append(userRow);
                    });
                }
            })
        })


        $('#addUser').on('click', function () {
            $('#userCard').html(
                `<div class="card-body d-flex flex-column">
                    <h1 class="card-title">Add User</h1>
                    <p>First Name <input type="text" id="txtFirstName"></p>
                    <p>Middle Name <input type="text" id="txtMiddleName"></p>
                    <p>Last Name <input type="text" id="txtLastName"></p>
                    <p>Username <input type="text" id="txtUsername"></p>
                    <p>Password <input type="text" id="txtPassword"></p>
                    <p>Admin <input type="checkbox" id="isAdmin"></p>
                    <div class='btn btn-primary col-2' id="btnCreateNewUser">Create New User</div>
                </div>`
            );
        })
        
        $('#btnCreateNewUser').on('click', function(){
            console.log("create new pressed");
            let firstname = $('#txtFirstName').value();
            let middlename = $('#txtMiddleName').value();
            let lastname = $('#txtLastName').value();
            let username = $('#txtUsername').value();
            let password = $('#txtPassword').value();
            let isAdmin = 0;
            if($('#isAdmin')){
                console.log("Is Admin");
                isAdmin = 1;
            }
            else{
                isAdmin = 0;
            }
            $.ajax({
                type: 'POST',
                url: `${apiCall}/addUser`,
                data: JSON.stringify({ uuidSessionToken: sessionStorage.getItem('SimpleSession'), strFirstName: firstname, strMiddleName: middlename, strLastName: lastname, strUserName: username, strPassword: password, intIsAdmin: isAdmin}),
                contentType: 'application/json',
                success: function(results){
                    console.log(results);
                }
            })
        })

        function selectUser(userID) {
            $.ajax({
                type: 'POST',
                url: `${apiCall}/getUserInfo`,
                data: JSON.stringify({ uuidSessionToken: sessionStorage.getItem('SimpleSession'), intUserID: userID }),
                contentType: 'application/json',
                success: function (results) {
                    console.log(results.User);
                    $('#userCard').html(
                        `
                        <div class="card-body d-flex flex-column">
                            <h1 class="card-title">${results.User.DisplayName}</h1>
                            <p class="card-text">Employee ID: ${results.User.EmployeeID}</p>
                            <p class="card-text">Username: ${results.User.UserName}</p>
                        </div>`);
                }
            })
        }
    </script>
</body>

</html>      